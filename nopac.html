<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Show drawn polygon area</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css" rel="stylesheet" />
<style>
	body { margin: 0; padding: 0; }
	#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<style>
    .calculation-box {
        height: 400px;
        width: 350px;
        position: absolute;
        bottom: 40px;
        left: 10px;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 15px;
        text-align: left;
    }

    p {
        font-family: 'Open Sans';
        margin: 0;
        font-size: 13px;
    }
</style>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.0/mapbox-gl-draw.js"></script>
<link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.2.0/mapbox-gl-draw.css"
    type="text/css"
/>
<div id="map"></div>
<div class="calculation-box">
<input class='btn' type='button' value = 'Update'>
        <form id='calculated-area'>
<textarea id = '2' class='coord' rows='1' cols='40'>
[[[-120.261291563,48.97711],[-120.037451563,38.950494699],[-114.729993746,32.71522],[-117.13762607,32.531679992],[-123.045489696,32.486428551],[-130.514414687,38.93452492],[-130.484755142,48.474489594],[-138.002274394,54.126706356],[-176.286774409,49.616639205],[-188.911159219,51.839875246],[-167.635689492,66.347298151],[-167.618146875,73.09922962],[-141.015272656,73.118468969],[-140.997919238,62.229801777],[-131.638737793,60.508585476],[-120.388539668,48.996336258],[-120.261291563,48.97711]]]
</textarea>

</div>

<script>

    // LOAD MAPBOX

	mapboxgl.accessToken = 'pk.eyJ1IjoicGllcnJlc2hpcGZpeCIsImEiOiJjazhvam92OTQwM2IyM2VvZ3RpNDlqa216In0.wsAexPRawHcmfMRydsewlw';
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/light-v10', //hosted style id
        center: [-45.874, 42.76], // starting position
        zoom: 1 // starting zoom
    });

    var draw = new MapboxDraw({
        displayControlsDefault: false,
        controls: {
            polygon: true,
            trash: true
        }
    });
    map.addControl(draw);



    // DRAW AND UPDATE COORDINATES BOX

    map.on('draw.create', updateArea);
    map.on('draw.delete', updateArea);
    map.on('draw.update', updateArea);
    map.on('draw.selectionchange', highlight);

    function updateArea(e) {
        var data = draw.getAll();
        var answer = document.getElementById('calculated-area');
        var content = '';
        data.features.forEach(function(obj) {
            content += '<p>Polygon ' + obj.id + '</p>' +
                        '<textarea id = "'+ obj.id + '" class="coord" rows="4" cols="40">' +
                        JSON.stringify(obj.geometry.coordinates) +
                        "</textarea><br>"
                        });
        answer.innerHTML = content
    }

    function highlight(e) {
        if (e.features.length > 0) {
            var id = e.features[0].id;
            document.getElementById(id).style.color = 'CornflowerBlue';
        } else {
            var elems = document.querySelectorAll('.coord');
            elems.forEach(function(obj) {
                obj.style.color = 'black';
            })

        }
    }

    // UPLOAD A POLYGON FROM COORDINATES BOX

    var feature = {
        id: "1",
        title: '',
        type: 'Feature',
        properties: {},
        geometry: { type: 'Polygon', coordinates:[]}
    };

    var btn = document.querySelector('input');
    btn.addEventListener('click', updateBtn);

    function updateBtn() {
        document.querySelectorAll('.coord').forEach(function(obj) {
                feature.geometry.coordinates = JSON.parse(obj.value);
                feature.id = obj.id;
                feature.title = 'Polygon';
                var featureIds = draw.add(feature);
                            });
    }


</script>

</body>
</html>